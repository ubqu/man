Причина **`hashdeep: Audit failed`** почти всегда одна и та же:
хотя бы **один файл** в каталоге *не совпадает* с тем, что записано в манифесте (по размеру и/или хэшу), либо появились/пропали файлы. Само сообщение «Audit failed» — это просто итог, без деталей. Детали есть, но:

* часть сообщений уходит в **stderr**,
* по умолчанию hashdeep не всегда печатает список всех расхождений (особенно если запускать скриптом).

Давай разберёмся по шагам, что именно могло пойти не так и как вытащить подробный отчёт.

---

## 1. Что означает `hashdeep: Audit failed`

Команда:

```bash
hashdeep -a -k 202407.sha256.manifest -r -l 202407
```

расшифровывается так:

* `-k manifest` — использовать **готовый файл хэшей** как «истину».
* `-a` — **audit mode**: сравнить текущие файлы с известными; при несоответствии выводит итог `Audit failed`.
* `-r -l` — рекурсивно и с относительными путями.

`Audit passed` на диске с ZFS означает:
*каждый файл, указанный в манифесте, присутствует и его хэш совпадает, и нет лишних/битых файлов*.

`Audit failed` на другом диске означает, что:

* либо есть **хотя бы один файл**, который изменился,
* либо что-то **отсутствует** или **появилось лишнее**,
* либо не совпали **пути** (каталог/подкаталог отличается).

Вывод типа:

```bash
hashdeep: Audit failed
```

— это только заголовок; выше (или в stderr) обычно есть подробный отчёт.

---

## 2. Как посмотреть подробности (что именно не совпало)

### 2.1 Запустить без `-a`, в «обычном» режиме проверки

Попробуй так:

```bash
cd /Volumes/ARCH20TB/20251018_NEED_BACKUP_iPhone15ProMax_backup

hashdeep -k 202407.sha256.manifest -r -l 202407
```

Без `-a` hashdeep покажет таблицу вида:

* `#### warning: ...`
* `X entries, Y matching, Z new files, ...`

И перечислит несовпадения (например, `new file`, `missing file`, `changed`).

### 2.2 Добавить «болтливость» (`-v` / `-vv`)

Чтобы увидеть ещё больше:

```bash
hashdeep -v -k 202407.sha256.manifest -r -l 202407
# или
hashdeep -vv -k 202407.sha256.manifest -r -l 202407
```

Это даст:

* список файлов,
* статус: `known`, `new`, `mismatch` и т.п.,
* сводку: сколько совпало, сколько не совпало.

### 2.3 Поймать весь вывод (stdout + stderr) в файл

Чтобы не потерять сообщения:

```bash
hashdeep -a -k 202407.sha256.manifest -r -l 202407 \
  > /tmp/hashdeep_202407.log 2>&1
```

Потом просто открой файл и посмотри, что конкретно ему не нравится.

---

## 3. Типичные причины, почему один диск проходит, а второй — нет

Вот что чаще всего ломает аудит, даже если ты «копировал одинаково» на два диска:

### 3.1 Манифест связался не с тем путём

Очень важно, **из какого каталога** ты создавал манифест, и откуда запускаешь проверку.

Ты писал раньше, что создавал манифест так (пример):

```bash
cd /Volumes/zfsdisk-backup22TB/Volumes/backup22TB/media/2024
hashdeep -r -l -c sha256 202407 > 202407.sha256.manifest
```

Тогда пути в манифесте выглядят примерно так:

```text
%%%% HASHDEEP-1.0
%%%% size,sha256,filename
12345,abcd1234...,202407/IMG_0001.JPG
...
```

Теперь ты проверяешь на **ARCH20TB**:

```bash
cd /Volumes/ARCH20TB/20251018_NEED_BACKUP_iPhone15ProMax_backup
hashdeep -a -k 202407.sha256.manifest -r -l 202407
```

Если структура на диске **точно такая же** (т.е. есть подкаталог `202407`, внутри те же файлы), пути совпадут, всё ок. Если же:

* ты проверяешь из другого каталога,
* или на одном диске `202407` лежит в другом месте,
* или при генерации манифеста путь был без префикса `202407` (например, ты делал `hashdeep -r -l .`),

то пути в манифесте могут **не совпадать** с тем, что hashdeep видит на ARCH20TB — и он посчитает файлы «новыми» или «отсутствующими».

Проверка:
открой `202407.sha256.manifest` в текстовом редакторе и посмотри, как выглядят `filename`. Убедись, что они совпадают с путями, которые видит `ls` на ARCH20TB.

### 3.2 Один из дисков слегка «подправил» файлы

Это маловероятно, но всё же:

* ФС может иметь особое поведение с атрибутами/ресурсными форками (реже — с данными).
* Некоторые утилиты/программы могли случайно изменить EXIF / «дописать превью» и т.п. после копирования на один из дисков.

Если хочешь проверить это быстро для одного подозрительного файла, можно в логах hashdeep найти конкретное имя и сравнить его хэши вручную:

```bash
shasum -a 256 202407/IMG_0001.JPG
# и то же на другом диске
```

Если SHA-256 различаются — файл реально изменился.

### 3.3 Не все файлы были скопированы

Если при копировании на один из дисков rsync ещё не успел закончить, либо были ошибки I/O (плохие сектора и пр.), то:

* манифест (созданный по «правильному» диску) содержит записи для файлов, которых **нет** на ARCH20TB;
* hashdeep в аудите покажет их как «missing».

См. лог `hashdeep -vv`, в нём будут строки вроде:

```text
missing,12345,abcd...,202407/IMG_0123.JPG
```

---

## 4. Как быстро локализовать проблему пошагово

Предлагаю такой алгоритм:

### Шаг 1. Проверить, что структура каталогов совпадает

На ZFS-диске (где `Audit passed`):

```bash
cd /Volumes/zfsdisk-backup22TB/...   # тот же корень, где лежит 202407 и manifest
find 202407 -type f | sort > /tmp/files_zfs.txt
```

На ARCH20TB:

```bash
cd /Volumes/ARCH20TB/20251018_NEED_BACKUP_iPhone15ProMax_backup
find 202407 -type f | sort > /tmp/files_arch.txt
```

Сравнить:

```bash
diff /tmp/files_zfs.txt /tmp/files_arch.txt
```

Если тут отличается список — уже понятно, где проблема (файлы лишние/отсутствуют).

### Шаг 2. Запустить hashdeep с verbose и логом

```bash
cd /Volumes/ARCH20TB/20251018_NEED_BACKUP_iPhone15ProMax_backup

hashdeep -vv -k 202407.sha256.manifest -r -l 202407 \
  > /tmp/hashdeep_202407_arch.log 2>&1
```

В логе ищем строки:

* `missing,` — файлы, которые есть в манифесте, но их нет на диске.
* `new,` — файлы, которых не было в манифесте.
* `mismatch,` или `changed` — размер/хэш не совпадает.

По этим строкам будет ясно, кто именно «сломался».

---

## 5. Краткий ответ на твой вопрос «почему failed и как узнать подробности»

1. `Audit failed` значит только одно: **есть расхождения с манифестом** (по файлам или путям).

2. Чтобы узнать подробности:

   * убери `-a` или добавь `-vv` и сохрани вывод в файл;
   * открой лог и посмотри строки `missing` / `new` / `mismatch`.

3. Скорее всего, в твоём случае:

   * на ARCH20TB структура (или число файлов) чуть отличается от ZFS-диска,
   * или при создании манифеста текущий каталог был другой, и пути в манифесте не совпадают с путями на ARCH20TB.

Если хочешь, можешь скинуть (обезличенно) 10–20 строк из `202407.sha256.manifest` и первые 10–20 строк из `/tmp/hashdeep_202407_arch.log`, и я помогу точечно расшифровать, что именно hashdeep считает «не так».
